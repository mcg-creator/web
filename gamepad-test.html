<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASUS ROG Ally Gamepad Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .gamepad-info {
            background: #444;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .button {
            background: #555;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            transition: background-color 0.1s;
        }
        .button.pressed {
            background: #0a84ff;
        }
        .axes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .axis {
            background: #555;
            padding: 15px;
            border-radius: 5px;
        }
        .console {
            background: #222;
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ® ASUS ROG Ally Gamepad Test</h1>
        
        <div class="status">
            <h3>Connection Status</h3>
            <div id="connectionStatus">No gamepads detected</div>
        </div>

        <div id="gamepadList"></div>

        <div class="buttons" id="buttonGrid">
            <!-- Buttons will be populated by JavaScript -->
        </div>

        <div class="axes" id="axesGrid">
            <!-- Axes will be populated by JavaScript -->
        </div>

        <div class="console" id="console">
            <h4>Console Log:</h4>
            <div id="consoleOutput"></div>
        </div>
    </div>

    <script>
        const connectionStatus = document.getElementById('connectionStatus');
        const gamepadList = document.getElementById('gamepadList');
        const buttonGrid = document.getElementById('buttonGrid');
        const axesGrid = document.getElementById('axesGrid');
        const consoleOutput = document.getElementById('consoleOutput');

        let lastGamepadState = null;

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${message}<br>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function initializeButtonGrid() {
            const buttonNames = [
                'A (0)', 'B (1)', 'X (2)', 'Y (3)',
                'LB (4)', 'RB (5)', 'LT (6)', 'RT (7)',
                'View (8)', 'Menu (9)', 'LS (10)', 'RS (11)',
                'D-Up (12)', 'D-Down (13)', 'D-Left (14)', 'D-Right (15)'
            ];

            buttonGrid.innerHTML = '';
            buttonNames.forEach((name, index) => {
                const button = document.createElement('div');
                button.className = 'button';
                button.id = `button-${index}`;
                button.textContent = name;
                buttonGrid.appendChild(button);
            });
        }

        function initializeAxesGrid() {
            const axisNames = ['Left Stick X', 'Left Stick Y', 'Right Stick X', 'Right Stick Y'];
            
            axesGrid.innerHTML = '';
            axisNames.forEach((name, index) => {
                const axis = document.createElement('div');
                axis.className = 'axis';
                axis.innerHTML = `<strong>${name}:</strong> <span id="axis-${index}">0.000</span>`;
                axesGrid.appendChild(axis);
            });
        }

        function updateGamepadDisplay() {
            const gamepads = navigator.getGamepads();
            let connectedCount = 0;
            
            gamepadList.innerHTML = '';
            
            for (let i = 0; i < gamepads.length; i++) {
                if (gamepads[i]) {
                    connectedCount++;
                    const gamepadInfo = document.createElement('div');
                    gamepadInfo.className = 'gamepad-info';
                    gamepadInfo.innerHTML = `
                        <strong>Gamepad ${i}:</strong> ${gamepads[i].id}<br>
                        <strong>Buttons:</strong> ${gamepads[i].buttons.length}<br>
                        <strong>Axes:</strong> ${gamepads[i].axes.length}
                    `;
                    gamepadList.appendChild(gamepadInfo);

                    // Update button states
                    gamepads[i].buttons.forEach((button, buttonIndex) => {
                        const buttonElement = document.getElementById(`button-${buttonIndex}`);
                        if (buttonElement) {
                            if (button.pressed) {
                                buttonElement.classList.add('pressed');
                                
                                // Log button press if it's new
                                const stateKey = `${i}-${buttonIndex}`;
                                if (!lastGamepadState || !lastGamepadState[stateKey]) {
                                    log(`ðŸŽ® Gamepad ${i} Button ${buttonIndex} pressed (value: ${button.value.toFixed(3)})`);
                                }
                                
                                if (!lastGamepadState) lastGamepadState = {};
                                lastGamepadState[stateKey] = true;
                            } else {
                                buttonElement.classList.remove('pressed');
                                
                                // Log button release
                                const stateKey = `${i}-${buttonIndex}`;
                                if (lastGamepadState && lastGamepadState[stateKey]) {
                                    log(`ðŸŽ® Gamepad ${i} Button ${buttonIndex} released`);
                                    delete lastGamepadState[stateKey];
                                }
                            }
                        }
                    });

                    // Update axis values
                    gamepads[i].axes.forEach((axis, axisIndex) => {
                        const axisElement = document.getElementById(`axis-${axisIndex}`);
                        if (axisElement) {
                            axisElement.textContent = axis.toFixed(3);
                            
                            // Log significant axis movement
                            if (Math.abs(axis) > 0.1) {
                                const stateKey = `axis-${i}-${axisIndex}`;
                                if (!lastGamepadState || Math.abs((lastGamepadState[stateKey] || 0) - axis) > 0.1) {
                                    log(`ðŸ•¹ï¸ Gamepad ${i} Axis ${axisIndex}: ${axis.toFixed(3)}`);
                                    if (!lastGamepadState) lastGamepadState = {};
                                    lastGamepadState[stateKey] = axis;
                                }
                            }
                        }
                    });
                }
            }

            if (connectedCount > 0) {
                connectionStatus.textContent = `${connectedCount} gamepad(s) connected`;
                connectionStatus.style.color = '#0a84ff';
            } else {
                connectionStatus.textContent = 'No gamepads detected';
                connectionStatus.style.color = '#ff453a';
            }
        }

        // Initialize the interface
        initializeButtonGrid();
        initializeAxesGrid();

        // Listen for gamepad events
        window.addEventListener('gamepadconnected', (e) => {
            log(`ðŸŽ® Gamepad connected: ${e.gamepad.id} (index: ${e.gamepad.index})`);
        });

        window.addEventListener('gamepaddisconnected', (e) => {
            log(`ðŸŽ® Gamepad disconnected: ${e.gamepad.id} (index: ${e.gamepad.index})`);
        });

        // Start polling
        function gamepadLoop() {
            updateGamepadDisplay();
            requestAnimationFrame(gamepadLoop);
        }

        log('ðŸš€ Gamepad test initialized. Connect your ASUS ROG Ally and press any button.');
        requestAnimationFrame(gamepadLoop);
    </script>
</body>
</html>